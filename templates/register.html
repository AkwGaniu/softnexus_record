{% extends 'index.html' %}

{% block content %}
  <div id="regApp">
    <div class="login-holder">
      <div class="login">
        <h3>Sign Up</h3>
        <span class="errMsg">
          [[ error ]]
        </span>
        <form action="#" method="post">
          {% csrf_token %}
          <div class="form-group">
            <span><i class="fa fa-user-o" aria-hidden="true"></i></span>
            <input
              type="text"
              v-model="user.username"
              autocomplete="off"
              placeholder="Username"
              @keyup.enter="register()"
            >
          </div>
          <div class="form-group">
            <span><i class="fa fa-email" aria-hidden="true"></i></span>
            <input
              type="text"
              v-model="user.email"
              autocomplete="off"
              placeholder="Email"
              @keyup.enter="register()"
            >
          </div>
          <div class="form-group">
            <span><i class="fa fa-unlock-alt" aria-hidden="true"></i></span>
            <input
              type="password"
              v-model="user.password"
              autocomplete="off"
              placeholder="Password"
              @keyup.enter="register()"
            >
          </div>
          <div class="form-group">
            <span><i class="fa fa-unlock-alt" aria-hidden="true"></i></span>
            <input 
              type="password"
              v-model="user.comfirmpass" 
              autocomplete="off"
              placeholder="Comfirm Password"
              @keyup.enter="register()"
            >
          </div>
          <input
            type="submit"
            @click.prevent="register()"
            value="Sign Up"
          > 
        </form>
      </div>
    </div>
  </div>
  <script>
    var loginApp = new Vue({
      delimiters: ['[[',']]'],
      el: '#regApp',
      data () {
        return {
          error: '',
          successMessage: '',
          user: {
            username: '',
            email: '',
            password: '',
            comfirmpass: ''
          }
        }
      },
      methods: {
        register () {
          username = this.user.username
          email = this.user.email
          password = this.user.password
          comfirmpass = this.user.comfirmpass
  
          if (password === '' || username === '' || email === '') {
            this.error = 'Please provide your login credentials'
          } else if (!this.validEmail(email)) {
            this.error = 'Please provide a valid email address'
          } else if (password.length < 6) {
            this.error = 'Your password cannot be less than 6 characters'
          } else if (password !== comfirmpass) {
            console.log(password + comfirmpass)
            this.error = 'Password fields does not match'
          } else {
            this.error = ''
            thissuccessMessage =''
            const payload = {
              username: username,
              email: email,
              password: password
            }
            axios.post('/register_user', payload)
            .then((response) => {
              //self.location = '/home'
              if (response.data.reply === 'success') {
                localStorage.setItem('message', JSON.stringify({message: 'Registration successful, Please login'}))
                self.location = '/'
              } else {
                this.error = response.data.reply
                console.log(response.data.reply)
              }
              console.log(response.data)
            })
            .catch((error) => {
              console.log({'error': error})
            })
          }
        },
        validEmail(email) {
          const regex = /^\S+@\S+\.\S+$/;
          if(regex.test(email) === false) {
              return false
          } else{
            return true
          }
        },
      }
    })
  </script>
{% endblock %}